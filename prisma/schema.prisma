// Prisma schema for Rate Your Day application
// Uses Azure Cosmos DB with MongoDB API
// Note: Using Prisma 6 for MongoDB support (Prisma 7 MongoDB support in development)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

// DayRating: Daily mood entry with optional notes
model DayRating {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  date      String   @unique // ISO format: YYYY-MM-DD
  rating    Int      // 1=angry, 2=sad, 3=average, 4=happy
  notes     String?  // Optional, max 280 characters
  userId    String   // User email from Entra ID
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, date])
}

// PushSubscription: Web Push API subscription for notifications
model PushSubscription {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @unique // One subscription per user
  endpoint  String   // Push service endpoint URL
  keys      Json     // VAPID keys: { p256dh, auth }
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
